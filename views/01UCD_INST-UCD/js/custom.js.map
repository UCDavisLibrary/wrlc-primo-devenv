{"version":3,"sources":["node_modules/browser-pack/_prelude.js","primo-explore/custom/01UCD_INST-UCD/js/external-search.js","primo-explore/custom/01UCD_INST-UCD/js/ga.js","primo-explore/custom/01UCD_INST-UCD/js/main.js","primo-explore/custom/01UCD_INST-UCD/js/search-bar-after.js","primo-explore/custom/01UCD_INST-UCD/js/search-result-availability-line-after.js","primo-explore/custom/01UCD_INST-UCD/js/utils.js","primo-explore/custom/01UCD_INST-UCD/node_modules/primo-explore-external-search/index.js","primo-explore/custom/01UCD_INST-UCD/node_modules/primo-explore-external-search/js/external-search.module.js","primo-explore/custom/01UCD_INST-UCD/node_modules/primo-explore-hathitrust-availability/index.js","primo-explore/custom/01UCD_INST-UCD/node_modules/primo-explore-hathitrust-availability/js/hathi-trust-availability.module.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","app","value","name","url","img","alt","mapping","queries","filters","query_mappings","any","title","creator","subject","isbn","issn","map","part","terms","split","join","loadGoogleAnalytics","angular","run","$rootScope","m","window","s","document","q","push","arguments","l","Date","createElement","getElementsByTagName","async","src","parentNode","insertBefore","ga","$on","trackHathiFinds","$scope","$element","children","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Object","entries","Symbol","iterator","next","done","_step$value","_slicedToArray","child","localName","hathi_links","_ret","already_sent","nativeElement","querySelector","getAttribute","v","hathi_record","primo_query","_utils","getParameterByName","hitType","eventCategory","eventAction","eventLabel","addEventListener","transport","_typeof","err","return","_ga","ucdlibVersion","_externalSearch2","default","_searchBarAfter2","_searchResultAvailabilityLineAfter2","component","bindings","parentCtrl","controller","templateUrl","$location","$window","this","navigateToHomePage","params","search","vid","lang","absUrl","console","log","baseUrl","location","href","browzine","api","apiKey","journalCoverImagesEnabled","journalBrowZineWebLinkTextEnabled","journalBrowZineWebLinkText","acticleBrowZineWebLinkTextEnabled","articleBrowZineWebLinkText","articlePDFDownloadLinkEnabled","articlePDFDownloadLinkText","printRecordsIntegrationEnabled","script","head","appendChild","primo","searchResult","gaHathiLoad","template","replace","results","RegExp","exec","decodeURIComponent","externalSearch","$onInit","setController","addExtSearch","$watch","getController","searchTargets","externalSearchText","facetGroup","targets","introText","query","filter","pfilter","prototype","toString","factory","prmFacetCtrl","ctrl","facets","unshift","displayedType","limitCount","facetGroupCollapsed","values","constant","config","$sceDelegateProvider","hathiTrustBaseUrl","urlWhitelist","resourceUrlWhitelist","$http","$q","lookup","ids","hathiTrustLookupUrl","jsonp","cache","jsonpCallbackParam","then","resp","data","resolve","svc","findRecord","bibData","recordId","keys","records","recordURL","catch","error","findFullViewRecord","fullTextUrl","result","j","items","item","usRightsString","toLowerCase","fromRecord","hathiTrust","self","msg","hideOnline","isOnline","hideIfJournal","isJournal","ignoreCopyright","isAvailable","updateHathiTrustAvailability","isOclcNum","match","prmSearchResultAvailabilityLine","pnx","addata","format","indexOf","delivery","availability","GetIt1","some","g","links","isLinktoOnline","deliveryCategory","hathiTrustIds","oclcid","id","res","fullTextLink","link","entityId"],"mappings":"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","file":"custom.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","export default function setExternalSearchValues(app){\n\n\tapp.value('searchTargets', [{\n\t\t\"name\": \"Worldcat\",\n\t\t\"url\": \"https://110105.on.worldcat.org/v2/search?\",\n\t\t\"img\": \"custom/01UCD_INST-UCD/img/worldcat-logo.png\",\n\t\t\"alt\": \"WorldCat logo\",\n\t\tmapping: function (queries, filters) {\n\t\t  const query_mappings = {\n\t\t\t'any': 'kw',\n\t\t\t'title': 'ti',\n\t\t\t'creator': 'au',\n\t\t\t'subject': 'su',\n\t\t\t'isbn': 'bn',\n\t\t\t'issn': 'n2'\n\t\t  }\n\t\t  try {\n\t\t\treturn 'queryString=' + queries.map(part => {\n\t\t\t  let terms = part.split(',')\n\t\t\t  let type = query_mappings[terms[0]] || 'kw'\n\t\t\t  let string = terms[2] || ''\n\t\t\t  let join = terms[3] || ''\n\t\t\t  return type + ':' + string + ' ' + join + ' '\n\t\t\t}).join('')\n\t\t  }\n\t\t  catch (e) {\n\t\t\treturn ''\n\t\t  }\n\t\t}\n\t  },\n\t\n\t  {\n\t\t\"name\": \"Google Scholar\",\n\t\t\"url\": \"https://scholar.google.com/scholar?q=\",\n\t\t\"img\": \"custom/01UCD_INST-UCD/img/google-scholar.svg\",\n\t\t\"alt\": \"Google Scholar Logo\",\n\t\tmapping: function (queries, filters) {\n\t\t  try {\n\t\t\treturn queries.map(part => part.split(\",\")[2] || \"\").join(' ')\n\t\t  }\n\t\t  catch (e) {\n\t\t\treturn ''\n\t\t  }\n\t\t}\n\t  }\n\t]);\n\t\n\tapp.value('externalSearchText', \"Can't find what you're looking for? Search items held at other libraries.\");\n\n}\n\n\n","import { getParameterByName } from './utils';\n\nexport function loadGoogleAnalytics(){\n\n  angular.module('googleAnalytics', []);\n  angular.module('googleAnalytics').run(['$rootScope', function ($rootScope) {\n\n    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\n      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\n      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');\n    \n      ga('create', 'UA-65988958-7', 'auto');\n\n      $rootScope.$on('$locationChangeSuccess', function(){\n        if ( ga ) ga('send', 'pageview');\n      });\n  }])\n}\n  \n  // Tracks if a record result is in the hathi trust\n  // Attached to the prmSearchResultAvailabilityLineAfter component in browzine.js\n  export function trackHathiFinds($scope, $element) {\n\n    if ( !ga ) return false;\n\n    // check for hathi full text\n    let children = $element.children();\n    for (let [k, child] of Object.entries(children)) {\n      if (child.localName == \"hathi-trust-availability\") {\n        let hathi_links = child.getElementsByTagName('a');\n        if (hathi_links.length > 0) {\n          let already_sent = $element.nativeElement.querySelector('ga-hathi-load')\n          if (already_sent && already_sent.getAttribute('event-sent') == 'true') {\n            return true\n          }\n\n          // send google analytics event\n          let hathi_record = hathi_links[0].getAttribute('href');\n          let primo_query = getParameterByName('query') ? getParameterByName('query') : '';\n          ga('send', {\n              hitType: 'event',\n              eventCategory: 'Hathi Load',\n              eventAction: hathi_record,\n              eventLabel: primo_query\n            });\n          hathi_links[0].addEventListener(\"click\", function(){\n            ga('send', 'event', {\n              eventCategory: 'Hathi Click',\n              eventAction: hathi_record,\n              eventLabel: primo_query,\n              transport: 'beacon'\n            });\n\n          });\n          //console.log(\"Event sent: \", hathi_record, primo_query);\n          return true\n\n        }\n        return false\n      }\n    }\n    return false\n  }\n  ","import 'primo-explore-external-search';\nimport 'primo-explore-hathitrust-availability';\nimport { loadGoogleAnalytics } from \"./ga\";\nimport setExternalSearchValues from './external-search';\nimport setSearchBarAfter from './search-bar-after';\nimport setSearchResultAvailabilityAfter from './search-result-availability-line-after';\n\n\nloadGoogleAnalytics();\n\n// Increment version before release\n// Doesn't actually bust the cache, but can be helpful info\nvar ucdlibVersion = \"2.0.0-alpha6\";\nwindow.ucdlibVersion = ucdlibVersion;\n\n// register our angular app\nconst REQUIRED_MODULES = [\n  'angularLoad', \n  'hathiTrustAvailability', \n  'externalSearch',\n  'googleAnalytics'\n];\nvar app = angular.module('viewCustom', REQUIRED_MODULES);\n\n// Customize the app\nsetExternalSearchValues(app);\nsetSearchBarAfter(app);\nsetSearchResultAvailabilityAfter(app);\n\n// Add any templates to cache\n//import('./customTemplates').then((customTemplates) => {\n//  customTemplates();\n//});\n//let customTemplates = await import('./customTemplates');\n//customTemplates();\n\n\n\n","\nexport default function setSearchBarAfter(app){\n  app.component('prmSearchBarAfter', {\n    bindings: { parentCtrl: '<' },\n    controller: 'SearchBarAfterController',\n    templateUrl: 'custom/01UCD_INST-UCD/html/templates/prmSearchBarAfter.html',\n});\n\napp.controller('SearchBarAfterController', ['$location', '$window', function($location, $window){\n  this.navigateToHomePage = function () {\n    var params = $location.search();\n    var vid = params.vid;\n    var lang = params.lang || \"en_US\";\n    var split = $location.absUrl().split('/discovery/');\n\n    if (split.length === 1) {\n      console.log(split[0] + ' : Could not detect the view name!');\n      return false;\n    }\n\n    var baseUrl = split[0];\n    $window.location.href = baseUrl + '/discovery/search?vid=' + vid + '&lang=' + lang;\n    return true;\n  };\n}]);\n}\n\n","import { trackHathiFinds } from './ga';\n\nexport default function setSearchResultAvailabilityAfter(app){\n  window.browzine = {\n    api: \"https://public-api.thirdiron.com/public/v1/libraries/75\",\n    apiKey: \"c5635332-0b38-4ded-9adc-b16be01f079c\",\n  \n    journalCoverImagesEnabled: true,\n  \n    journalBrowZineWebLinkTextEnabled: true,\n    journalBrowZineWebLinkText: \"View Journal Contents\",\n  \n    acticleBrowZineWebLinkTextEnabled: true,\n    articleBrowZineWebLinkText: \"View Issue Contents\",\n  \n    articlePDFDownloadLinkEnabled: true,\n    articlePDFDownloadLinkText: \"Download PDF\",\n  \n    printRecordsIntegrationEnabled: true\n  };\n  \n  browzine.script = document.createElement(\"script\");\n  browzine.script.src = \"https://s3.amazonaws.com/browzine-adapters/primo/browzine-primo-adapter.js\";\n  document.head.appendChild(browzine.script);\n  \n  app.controller('prmSearchResultAvailabilityLineAfterController', ['$scope', '$element', function ($scope, $element) {\n    var vm = this;\n    window.browzine.primo.searchResult($scope);\n\n    vm.gaHathiLoad = gaHathiLoad;\n    function gaHathiLoad() {\n      return trackHathiFinds($scope, $element);\n    }\n  }]);\n  \n  // attach hathitrust to the same component\n  app.component('prmSearchResultAvailabilityLineAfter', {\n    bindings: { parentCtrl: '<' },\n    controller: 'prmSearchResultAvailabilityLineAfterController',\n    template: '<hathi-trust-availability hide-online=\"true\" hide-if-journal=\"false\" ignore-copyright=\"true\"></hathi-trust-availability><ga-hathi-load event-sent=\"{{$ctrl.gaHathiLoad()}}\"></ga-hathi-load>'\n  });\n\n}\n","export function getParameterByName(name, url) {\n    if (!url) url = window.location.href;\n    name = name.replace(/[\\[\\]]/g, \"\\\\$&\");\n    var regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\"),\n        results = regex.exec(url);\n    if (!results) return null;\n    if (!results[2]) return '';\n    return decodeURIComponent(results[2].replace(/\\+/g, \" \"));\n  }","require('./js/external-search.module.js')\nmodule.exports = 'externalSearch'\n","angular\n  .module('externalSearch', [])\n  .value('searchTargets', [])\n  .value('externalSearchText', \"\")\n  .component('prmFacetAfter', {\n      bindings: { parentCtrl: '<' },\n      controller: ['externalSearch', '$scope', function (externalSearch, $scope) {\n        this.$onInit = function () {\n          externalSearch.setController(this.parentCtrl)\n          externalSearch.addExtSearch();\n          $scope.$watch('$ctrl.parentCtrl.facets', function(){\n            externalSearch.addExtSearch()});\n        }\n      }]\n  })\n  .component('prmPageNavMenuAfter', {\n    controller: ['externalSearch', function (externalSearch) {\n      this.$onInit = function () {\n        if (externalSearch.getController()) externalSearch.addExtSearch()\n      }\n    }]\n  })\n  .component('prmFacetExactAfter', {\n      bindings: { parentCtrl: '<' },\n      template: '<div ng-if=\"name === \\'External Search\\'\">\\\n          <div ng-hide=\"$ctrl.parentCtrl.facetGroup.facetGroupCollapsed\">\\\n              <div class=\"section-content animate-max-height-variable\">\\\n                  <div ng-if=\"introText\" id=\"external-search-intro\">{{introText}}</div>\\\n                  <div class=\"md-chips md-chips-wrap\">\\\n                      <div ng-repeat=\"target in targets\" aria-live=\"polite\" class=\"md-chip animate-opacity-and-scale facet-element-marker-local4\">\\\n                          <div class=\"md-chip-content layout-row\" role=\"button\" tabindex=\"0\">\\\n                              <strong dir=\"auto\" title=\"{{ target.name }}\">\\\n                                  <a ng-href=\"{{ target.url + target.mapping(queries, filters) }}\" target=\"_blank\">\\\n                                      <img ng-src=\"{{ target.img }}\" width=\"22\" height=\"22\" alt=\"{{ target.alt }}\" style=\"vertical-align:middle;\"> {{ target.name }}\\\n                                  </a>\\\n                              </strong>\\\n                          </div>\\\n                      </div>\\\n                  </div>\\\n              </div>\\\n          </div>\\\n      </div>',\n      controller: ['$scope', '$location', 'searchTargets', 'externalSearchText', function ($scope, $location, searchTargets, externalSearchText) {\n        this.$onInit = function () {\n          $scope.name = this.parentCtrl.facetGroup.name\n          $scope.targets = searchTargets\n          $scope.introText = externalSearchText\n          var query = $location.search().query\n          var filter = $location.search().pfilter\n          $scope.queries = Object.prototype.toString.call(query) === '[object Array]' ? query : query ? [query] : false\n          $scope.filters = Object.prototype.toString.call(filter) === '[object Array]' ? filter : filter ? [filter] : false\n        }\n      }]\n  })\n  .factory('externalSearch', function () {\n    return {\n      getController: function () {\n        return this.prmFacetCtrl || false\n      },\n      setController: function (controller) {\n        this.prmFacetCtrl = controller\n      },\n      addExtSearch: function addExtSearch(ctrl) {\n        if ( !ctrl ) ctrl = this.prmFacetCtrl;\n        if ( \n          ctrl.facets.length < 1 ||\n          ctrl.facets[0].name !== 'External Search' \n          ) {\n          ctrl.facets.unshift({\n            name: 'External Search',\n            displayedType: 'exact',\n            limitCount: 0,\n            facetGroupCollapsed: false,\n            values: []\n          });\n        }\n      }\n    }\n  })\n","require('./js/hathi-trust-availability.module.js');\nmodule.exports = 'hathiTrustAvailability';\n","angular\n  .module('hathiTrustAvailability', [])\n  .constant(\n    'hathiTrustBaseUrl',\n    'https://catalog.hathitrust.org/api/volumes/brief/json/'\n  )\n  .config([\n    '$sceDelegateProvider',\n    'hathiTrustBaseUrl',\n    function ($sceDelegateProvider, hathiTrustBaseUrl) {\n      var urlWhitelist = $sceDelegateProvider.resourceUrlWhitelist();\n      urlWhitelist.push(hathiTrustBaseUrl + '**');\n      $sceDelegateProvider.resourceUrlWhitelist(urlWhitelist);\n    },\n  ])\n  .factory('hathiTrust', [\n    '$http',\n    '$q',\n    'hathiTrustBaseUrl',\n    function ($http, $q, hathiTrustBaseUrl) {\n      var svc = {};\n\n      var lookup = function (ids) {\n        if (ids.length) {\n          var hathiTrustLookupUrl = hathiTrustBaseUrl + ids.join('|');\n          return $http\n            .jsonp(hathiTrustLookupUrl, {\n              cache: true,\n              jsonpCallbackParam: 'callback',\n            })\n            .then(function (resp) {\n              return resp.data;\n            });\n        } else {\n          return $q.resolve(null);\n        }\n      };\n\n      // find a HT record URL for a given list of identifiers (regardless of copyright status)\n      svc.findRecord = function (ids) {\n        return lookup(ids)\n          .then(function (bibData) {\n            for (var i = 0; i < ids.length; i++) {\n              var recordId = Object.keys(bibData[ids[i]].records)[0];\n              if (recordId) {\n                return $q.resolve(bibData[ids[i]].records[recordId].recordURL);\n              }\n            }\n            return $q.resolve(null);\n          })\n          .catch(function (e) {\n            console.error(e);\n          });\n      };\n\n      // find a public-domain HT record URL for a given list of identifiers\n      svc.findFullViewRecord = function (ids) {\n        var handleResponse = function (bibData) {\n          var fullTextUrl = null;\n          for (var i = 0; !fullTextUrl && i < ids.length; i++) {\n            var result = bibData[ids[i]];\n            for (var j = 0; j < result.items.length; j++) {\n              var item = result.items[j];\n              if (item.usRightsString.toLowerCase() === 'full view') {\n                fullTextUrl = result.records[item.fromRecord].recordURL;\n                break;\n              }\n            }\n          }\n          return $q.resolve(fullTextUrl);\n        };\n        return lookup(ids)\n          .then(handleResponse)\n          .catch(function (e) {\n            console.error(e);\n          });\n      };\n\n      return svc;\n    },\n  ])\n  .controller('hathiTrustAvailabilityController', [\n    'hathiTrust',\n    function (hathiTrust) {\n      var self = this;\n\n      self.$onInit = function () {\n        if (!self.msg) self.msg = 'Full Text Available at HathiTrust';\n\n        // prevent appearance/request iff 'hide-online'\n        if (self.hideOnline && isOnline()) {\n          return;\n        }\n\n        // prevent appearance/request iff 'hide-if-journal'\n        if (self.hideIfJournal && isJournal()) {\n          return;\n        }\n\n    \t// prevent appearance/request if item is unavailable\n    \tif (self.ignoreCopyright && !isAvailable()) {\n    \t   //allow links for locally unavailable items that are in the public domain\n           self.ignoreCopyright=false;\n        }\n\n        // look for full text at HathiTrust\n        updateHathiTrustAvailability();\n      };\n\n      var isJournal = function () {\n        var format =\n          self.prmSearchResultAvailabilityLine.result.pnx.addata.format[0];\n        return !(format.toLowerCase().indexOf('journal') == -1); // format.includes(\"Journal\")\n      };\n\n      var isAvailable = function isAvailable() {\n\tvar available = self.prmSearchResultAvailabilityLine.result.delivery.availability[0];\n\treturn (available.toLowerCase().indexOf('unavailable') == -1); \n      };\n\n      var isOnline = function () {\n        var delivery =\n          self.prmSearchResultAvailabilityLine.result.delivery || [];\n        if (!delivery.GetIt1)\n          return delivery.deliveryCategory.indexOf('Alma-E') !== -1;\n        return self.prmSearchResultAvailabilityLine.result.delivery.GetIt1.some(\n          function (g) {\n            return g.links.some(function (l) {\n              return l.isLinktoOnline;\n            });\n          }\n        );\n      };\n\n      var formatLink = function (link) {\n        return self.entityId ? link + '?signon=swle:' + self.entityId : link;\n      };\n\n      var isOclcNum = function (value) {\n        return value.match(/^(\\(ocolc\\))?\\d+$/i);\n      };\n\n      var updateHathiTrustAvailability = function () {\n        var hathiTrustIds = (\n          self.prmSearchResultAvailabilityLine.result.pnx.addata.oclcid || []\n        )\n          .filter(isOclcNum)\n          .map(function (id) {\n            return 'oclc:' + id.toLowerCase().replace('(ocolc)', '');\n          });\n        hathiTrust[self.ignoreCopyright ? 'findRecord' : 'findFullViewRecord'](\n          hathiTrustIds\n        ).then(function (res) {\n          if (res) self.fullTextLink = formatLink(res);\n        });\n      };\n    },\n  ])\n  .component('hathiTrustAvailability', {\n    require: {\n      prmSearchResultAvailabilityLine: '^prmSearchResultAvailabilityLine',\n    },\n    bindings: {\n      entityId: '@',\n      ignoreCopyright: '<',\n      hideIfJournal: '<',\n      hideOnline: '<',\n      msg: '@?',\n    },\n    controller: 'hathiTrustAvailabilityController',\n    template:\n      '<span ng-if=\"$ctrl.fullTextLink\" class=\"umnHathiTrustLink\">\\\n                <md-icon alt=\"HathiTrust Logo\">\\\n                  <svg version=\"1.1\" id=\"Layer_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" width=\"100%\" height=\"100%\" viewBox=\"0 0 16 16\" enable-background=\"new 0 0 16 16\" xml:space=\"preserve\">  <image id=\"image0\" width=\"16\" height=\"16\" x=\"0\" y=\"0\"\\\n                  xlink:href=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAABGdBTUEAALGPC/xhBQAAACBjSFJN\\\n                  AAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAACNFBMVEXuegXvegTsewTveArw\\\n                  eQjuegftegfweQXsegXweQbtegnsegvxeQbvegbuegbvegbveQbtegfuegbvegXveQbvegbsfAzt\\\n                  plfnsmfpq1/wplPuegXvqFrrq1znr2Ptok/sewvueQfuegbtegbrgRfxyJPlsXDmlTznnk/rn03q\\\n                  pVnomkjnlkDnsGnvwobsfhPveQXteQrutHDqpF3qnUnpjS/prmDweQXsewjvrWHsjy7pnkvqqGDv\\\n                  t3PregvqhB3uuXjusmzpp13qlz3pfxTskC3uegjsjyvogBfpmkHpqF/us2rttXLrgRjrgBjttXDo\\\n                  gx/vtGznjzPtfhHqjCfuewfrjCnwfxLpjC7wtnDogBvssmjpfhLtegjtnEjrtnTmjC/utGrsew7s\\\n                  o0zpghnohB/roUrrfRHtsmnlkTbrvH3tnEXtegXvegTveQfqhyHvuXjrrGTpewrsrmXqfRHogRjt\\\n                  q2Dqewvqql/wu3vqhyDueQnwegXuegfweQPtegntnUvnt3fvxI7tfhTrfA/vzJvmtXLunEbtegrw\\\n                  egTregzskjbsxI/ouoPsqFzniyrz2K3vyZnokDLpewvtnkv30J/w17XsvYXjgBbohR7nplnso1L0\\\n                  1Kf40Z/um0LvegXngBnsy5juyJXvsGftrGTnhB/opVHoew7qhB7rzJnnmErkkz3splbqlT3smT3t\\\n                  tXPqqV7pjzHvunjrfQ7vewPsfA7uoU3uqlruoEzsfQ/vegf///9WgM4fAAAAFHRSTlOLi4uLi4uL\\\n                  i4uLi4uLi4tRUVFRUYI6/KEAAAABYktHRLvUtndMAAAAB3RJTUUH4AkNDgYNB5/9vwAAAQpJREFU\\\n                  GNNjYGBkYmZhZWNn5ODk4ubh5WMQERUTl5CUEpWWkZWTV1BUYlBWUVVT19BUUtbS1tHV0zdgMDQy\\\n                  NjE1MzRXsrC0sraxtWOwd3B0cnZxlXZz9/D08vbxZfDzDwgMCg4JdQsLj4iMio5hiI2LT0hMSk5J\\\n                  TUvPyMzKzmHIzcsvKCwqLiktK6+orKquYZCuratvaGxqbmlta+8QNRBl6JQ26Oru6e3rnzBx0uQ8\\\n                  aVGGvJopU6dNn1E8c9bsOXPniYoySM+PXbBw0eIlS5fl1C+PFRFlEBUVXbFy1eo1a9fliQDZYIHY\\\n                  9fEbNm7avEUUJiC6ddv2HTt3mSuBBfhBQEBQSEgYzOIHAHtfTe/vX0uvAAAAJXRFWHRkYXRlOmNy\\\n                  ZWF0ZQAyMDE2LTA5LTEzVDE0OjA2OjEzLTA1OjAwNMgVqAAAACV0RVh0ZGF0ZTptb2RpZnkAMjAx\\\n                  Ni0wOS0xM1QxNDowNjoxMy0wNTowMEWVrRQAAAAASUVORK5CYII=\" />\\\n                  </svg> \\\n                </md-icon>\\\n                <a target=\"_blank\" ng-href=\"{{$ctrl.fullTextLink}}\">\\\n                {{ ::$ctrl.msg }}\\\n                  <prm-icon external-link=\"\" icon-type=\"svg\" svg-icon-set=\"primo-ui\" icon-definition=\"open-in-new\"></prm-icon>\\\n                </a>\\\n              </span>',\n  });\n"]}